flowchart TB
    subgraph Decoder
        direction TB
        D_OUT[Output Probabilities]
        D_SM[Softmax]
        D_LIN[Linear]
        D_FF[Feed Forward]
        D_MHA2[Multi-Head Attention]
        D_MMHA[Masked Multi-Head Attention]
        D_PE[Positional Encoding]
        D_EMB[Output Embedding]
        D_IN[Outputs shifted right]

        D_IN --> D_EMB --> D_PE --> D_MMHA --> D_MHA2 --> D_FF --> D_LIN --> D_SM --> D_OUT
    end

    subgraph Encoder
        direction TB
        E_OUT[Encoder Output]
        E_FF[Feed Forward]
        E_MHA[Multi-Head Attention]
        E_PE[Positional Encoding]
        E_EMB[Input Embedding]
        E_IN[Inputs]

        E_IN --> E_EMB --> E_PE --> E_MHA --> E_FF --> E_OUT
    end

    E_OUT --> D_MHA2
